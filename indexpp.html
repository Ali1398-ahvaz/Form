
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ماشین‌حساب حرفه‌ای — مکی لویمی</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background: linear-gradient(180deg,#f8fafc 0%, #f1f5f9 100%);
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .wrap { width: 100%; max-width: 420px; }
    .title { text-align: center; font-size: 28px; font-weight: bold; }
    .author { text-align: center; margin-top: 8px; }
    .badge { background: #000; color:#fff; padding: 4px 12px; border-radius: 20px; }
    .card { background:#fff; border-radius: 16px; padding:16px; margin-top:12px;
            box-shadow:0 4px 16px rgba(0,0,0,.1);}
    .screen { background:#f8fafc; border:1px solid #ddd; border-radius:12px; padding:12px;}
    .expr { min-height:40px; font-family: monospace; font-size: 20px; text-align:right;}
    .ans { font-family: monospace; font-size: 24px; text-align:right; margin-top:4px;}
    .grid { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin-top:12px;}
    .key { padding:14px; font-size:18px; font-weight:bold; border-radius:12px; border:1px solid #ddd; background:#f1f5f9; cursor:pointer;}
    .key:active { transform: scale(0.95); }
    .eq { background:#000; color:#fff; }
    .toolbar { display:flex; gap:8px; margin:10px 0; }
    .btn { flex:1; padding:10px; border-radius:12px; cursor:pointer; font-weight:bold;}
    .btn-ac { background:#fee2e2; }
    .btn-del { background:#ffedd5; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">ماشین‌حساب حرفه‌ای</div>
    <div class="author">نویسنده: <span class="badge">مکی لویمی</span></div>

    <div class="card">
      <div class="screen">
        <div id="expr" class="expr">۰</div>
        <div id="ans" class="ans">0</div>
      </div>

      <div class="toolbar">
        <button id="ac" class="btn btn-ac">AC</button>
        <button id="del" class="btn btn-del">حذف</button>
      </div>

      <div class="grid" id="keys"></div>
    </div>
  </div>

  <script>
    const normalize = (s) => s.replace(/[۰-۹×÷−٪]/g, (m)=>({
      "۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5",
      "۶":"6","۷":"7","۸":"8","۹":"9","×":"*","÷":"/","−":"-","٪":"%"}[m]||m));

    function evaluateExpression(expr){
      try {
        const n = normalize(expr);
        if (/[^0-9+\\-*/%().\\s]/.test(n)) return "خطا";
        const pct = n.replace(/(\\d+(?:\\.\\d+)?)%/g, '($1/100)');
        const val = Function('return (' + pct + ')')();
        if (typeof val === 'number' && isFinite(val)) return val;
        return "خطا";
      } catch { return "خطا"; }
    }

    const KEYS = [
      {l:"("},{l:")"},{l:"÷",v:"/"},{l:"×",v:"*"},
      {l:"7"},{l:"8"},{l:"9"},{l:"−",v:"-"},
      {l:"4"},{l:"5"},{l:"6"},{l:"+",v:"+"},
      {l:"1"},{l:"2"},{l:"3"},{l:"%"},
      {l:"0"},{l:"."},{l:"=",c:"eq"}
    ];

    const exprEl=document.getElementById("expr");
    const ansEl=document.getElementById("ans");
    const keysEl=document.getElementById("keys");
    let expr="";

    function render(){
      exprEl.textContent = expr || "۰";
      ansEl.textContent = expr ? evaluateExpression(expr) : "0";
    }

    function press(k){
      if(k==="="){ expr=String(evaluateExpression(expr)); render(); return;}
      expr+=k; render();
    }

    KEYS.forEach(k=>{
      const b=document.createElement("button");
      b.className="key"+(k.c?(" "+k.c):"");
      b.textContent=k.l;
      b.onclick=()=>press(k.v||k.l);
      keysEl.appendChild(b);
    });

    document.getElementById("ac").onclick=()=>{expr=""; render();};
    document.getElementById("del").onclick=()=>{expr=expr.slice(0,-1); render();};
    render();
  </script>
</body>
</html>
